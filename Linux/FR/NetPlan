# NetPlan

Absolument. Voici des informations sur `netplan` basées sur les sources que vous avez fournies.

**Netplan** est l'outil par défaut pour la configuration réseau sur les systèmes Ubuntu, en particulier sur les éditions Server. Il offre une méthode de haut niveau pour définir la configuration réseau de votre système à l'aide de fichiers de configuration **YAML**. Netplan agit comme un **renderer** d'abstraction de configuration réseau.

Sur **Ubuntu Core**, bien que **NetworkManager** soit le gestionnaire réseau par défaut, il prend le contrôle en s'établissant lui-même comme le renderer Netplan via un fichier de configuration Netplan. Ce comportement peut être contrôlé avec l'option `defaultrenderer` du snap `network-manager`. À partir de **core20**, NetworkManager utilise un backend YAML basé sur la fonctionnalité `libnetplan`, remplaçant le format keyfile précédent.

**Fichiers de Configuration Netplan**

* Les configurations Netplan sont écrites dans des **fichiers YAML**.
* Ces fichiers sont généralement situés dans le répertoire `/etc/netplan/`.
* Un nom de fichier couramment utilisé pour les configurations ajoutées manuellement est `/etc/netplan/99_config.yaml`.
* Sur Ubuntu Core, le fichier de configuration par défaut généré par `console-conf` est souvent `/etc/netplan/00-snapd-config.yaml`.
* À partir d'Ubuntu 23.10, les fichiers de configuration de connexion NetworkManager sont stockés sous forme de fichiers YAML dans `/etc/netplan`.

**Application des Changements Netplan**

Pour appliquer les modifications apportées aux fichiers de configuration Netplan, utilisez la commande `netplan apply`. Il est recommandé de générer et vérifier la configuration avant de l'appliquer en utilisant `netplan generate`.

**Configuration Réseau avec Netplan**

Netplan permet de configurer divers aspects du réseau de manière persistante, contrairement aux commandes comme `ip` ou `ifconfig` qui appliquent des configurations temporaires.

* **Interfaces Ethernet**:
  * Les interfaces sont identifiées par des noms prévisibles comme `eno1` ou `enp0s25`, ou parfois par le style `eth#` du noyau.
  * Vous pouvez identifier les interfaces à l'aide de la commande `ip a` ou `lshw -class network`.
  * Les noms logiques des interfaces peuvent être configurés dans le fichier YAML Netplan en utilisant les clés `match` et `set-name`.
* **Attribution Statique d'Adresse IP**:
  * Dans le fichier YAML, sous la définition de l'interface Ethernet, spécifiez les adresses IP et les sous-réseaux sous `addresses`.
  * Configurez les routes sous `routes`, y compris la route par défaut (`to: default via: <passerelle>`). Notez que dans Ubuntu Bionic 18.04 LTS, la syntaxe `gateway4: <passerelle>` était utilisée au lieu du bloc `routes` pour la passerelle par défaut.
  * Les serveurs de noms et les listes de recherche DNS sont configurés sous `nameservers`.
* **Attribution Dynamique d'Adresse IP (Client DHCP)**:
  * Dans le fichier YAML, sous la définition de l'interface Ethernet, spécifiez `dhcp4: true`.
* **Résolution de Noms**:
  * Netplan configure le service `systemd-resolved` pour la configuration des serveurs de noms.
  * Les adresses IP des serveurs de noms et les listes de recherche de suffixes DNS sont ajoutées sous la clé `nameservers` dans le fichier de configuration Netplan.
  * Le fichier `/etc/resolv.conf` est généralement un lien symbolique vers un fichier géré par `systemd-resolved`.
  * Les noms d'hôtes statiques définis dans le fichier `/etc/hosts` ont par défaut la priorité sur la résolution DNS.
  * L'ordre de recherche des méthodes de résolution de noms est contrôlé par le fichier `/etc/nsswitch.conf`.
* **Pontage (Bridging)**:
  * Vous pouvez configurer une interface de pont dans le fichier YAML en spécifiant ses propres paramètres IP (DHCP ou statique) et en listant les interfaces physiques à inclure dans le pont sous la clé `interfaces`.
* **Scripts Hooks:**
  * Netplan ne prend pas en charge les scripts hooks directement dans sa configuration.
  * Les utilisateurs peuvent utiliser `networkd-dispatcher` (avec le renderer networkd) ou les scripts du NM Dispatcher (avec NetworkManager) pour réagir aux changements d'état du réseau.

**Relation avec NetworkManager**

Sur Ubuntu Core à partir de core20, NetworkManager utilise un backend YAML basé sur `libnetplan`.

* Les fichiers YAML Netplan (par exemple `/etc/netplan/00-snapd-config.yaml`) sont traités par le générateur Netplan.io au démarrage pour créer la configuration NetworkManager dans `/run/NetworkManager/system-connections`.
* Si une connexion est modifiée ou créée via NetworkManager (par exemple avec `nmcli`), NetworkManager convertit la configuration en YAML Netplan et la stocke dans `/etc/netplan`. Il appelle ensuite `netplan generate` pour retraiter la configuration YAML actuelle.
* Les options de configuration non prises en charge par le backend YAML de NetworkManager sont stockées dans un mapping `networkmanager.passthrough` dans le YAML pour éviter leur perte.

**Commandes Utiles**

* `netplan apply` : Appliquer la configuration.
* `netplan generate` : Générer les fichiers de configuration backend à partir des fichiers YAML.
* `netplan get` : Lire la configuration système.
* `netplan set` : Modifier les paramètres système.
* `netplan --help` ou `man netplan` : Obtenir plus d'informations.

Netplan simplifie la configuration réseau en utilisant un format de configuration centralisé et lisible par l'homme (YAML), offrant une gestion cohérente des interfaces réseau sur différents systèmes Ubuntu.