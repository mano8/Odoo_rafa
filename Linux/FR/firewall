# **Pare-feux (Firewalls)**

Le noyau Linux utilise le sous-système Netfilter pour gérer le trafic réseau. Les outils de pare-feu comme `iptables` et `ufw` utilisent Netfilter.

* **`iptables`** : L'outil de bas niveau pour gérer les règles Netfilter. Il peut être utilisé pour la configuration de pare-feu et le masquage IP. Cependant, il est complexe et de nombreux frontends sont disponibles pour le simplifier.
* **`ufw`** (Uncomplicated Firewall) : L'outil de configuration de pare-feu par défaut pour Ubuntu, conçu pour simplifier la gestion des règles `iptables`.
  * Pour **activer** `ufw` : `sudo ufw enable`. Par défaut, `ufw` bloque l'accès externe à tous les ports.
  * Pour **désactiver** `ufw` : `sudo ufw disable`.
  * Pour **ouvrir** un port : `sudo ufw allow <port>` (ex: `sudo ufw allow 22` pour SSH). Vous pouvez utiliser le nom du service si défini dans `/etc/services` (ex: `sudo ufw allow ssh`).
  * Pour **fermer** un port : `sudo ufw deny <port>` (ex: `sudo ufw deny 22`).
  * Les règles peuvent être ajoutées numérotées (`sudo ufw insert <nombre> allow <port>`).
  * Pour **supprimer** une règle : `sudo ufw delete allow <port>` ou `sudo ufw delete <numéro>` après avoir listé les règles numérotées avec `sudo ufw status numbered`.
  * Autoriser l'accès depuis des hôtes ou réseaux spécifiques : `sudo ufw allow proto tcp from <adresse_ip> to any port <port>`.
  * L'option `--dry-run` permet de simuler l'application d'une règle sans la modifier réellement.
  * Vérifier le statut : `sudo ufw status` ou `sudo ufw status verbose`.
  * **Profils d'application `ufw`** : Les applications peuvent inclure des profils qui détaillent les ports nécessaires. Listez les profils disponibles avec `sudo ufw app list`. Activez un profil avec `sudo ufw allow <NomProfile>` (ex: `sudo ufw allow "OpenSSH"`). Affichez les détails d'un profil avec `sudo ufw app info <NomProfile>`.
  * **Masquage IP avec `ufw`** : Le masquage IP permet aux machines d'un réseau privé d'accéder à Internet via une machine faisant office de passerelle. Avec `ufw`, cela se fait en modifiant les fichiers `/etc/default/ufw` (changer `DEFAULT_FORWARD_POLICY` à "ACCEPT") et `/etc/ufw/sysctl.conf` (décommenter `net.ipv4.ip_forward=1`), puis en ajoutant des règles dans `/etc/ufw/before.rules` (table `nat`, chaîne `POSTROUTING`). Redémarrez `ufw` pour appliquer les changements (`sudo ufw disable && sudo ufw enable`).
  * **Journalisation (`ufw`)** : Activez la journalisation avec `sudo ufw logging on`. Les logs apparaissent dans les journaux système comme `/var/log/messages`, `/var/log/syslog`, et `/var/log/kern.log`.